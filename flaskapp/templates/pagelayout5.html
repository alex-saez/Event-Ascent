<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>News Snap</title>

    <!-- Bootstrap core CSS -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">


    <script src="http://d3js.org/d3.v2.js"></script> 

    <style>

        .bodyclass { 
            background-color:#dddddd ;
        }


        .main-background { 
            background-color:#888888 ;
        }

        .summary {
            position: absolute;
            left: 20px;
            width: 800px;
            font-size: 30;
          <!--  border: 1px solid #000000;
            padding: 3px; -->
        }

        h4 {
            color: black;
            padding-top: 0px;
            padding-bottom: 0px;
        }

        .summary {
            padding: 0px;
        }

        .btn-default{
            height:30px;
            width:50px;
            padding:0px;
        }

    </style>

</head>



<body class="bodyclass">

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">News Snap</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Date Explorer</a></li>
            <li><a href="#contact">About</a></li>
            <li><a href="/gdata?inputdate={{inputdate}}">See data</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

 <br><br><br>

    <div class = "container">
      <form  action="/" method="GET">
        <div class="form-group">
            <label for="date"> <h4>Pick Date of Interest:</h4> </label>
            <span style="display:inline-block; width: 20px;"></span>
            <input id="inputdate" name='inputdate' type="date" value="{{inputdate}}">
            <span style="display:inline-block; width: 20px;"></span>
            <button type="submit" class="btn btn-default btn-lg">Go</button>
        </div>
      </form>
    </div>


<div class = "main-background">
    <span style="display:inline-block; width: 10px;"></span>
    <label for="date"> <h4>Main topics of the day on the NY Times. Hover to see headlines (bar size reflects number of articles on the topic)</h4> </label>
    <div id="viz" class = "vizwin" style="height:270px;"></div>
    <hr style="border-color:#000000; border-width: 2px;"> 
</div>


    <div class="summary">
        <h3>Headlines by relevance:</h3>
        <div id="summWin"> </div>
    </div>




    <script type="text/javascript">

    var display_summary = function (d) {
        d3.select("#summWin").html( d.summary )
        d3.select(this).style("stroke-width", 3);
        d3.select(this).style("font-weight", "bold");
    };


    var callback = function(data) {

        var w = 1000, h = 300;
        var sampleSVG = d3.select("#viz")
            .append("svg")
            .attr("width", w)
            .attr("height", h)
            .append("svg:g")
            .attr("transform", "translate(10, 0)");

        var bar_dx=40, bar_dy=30, bar_dist=35
        sampleSVG.selectAll("rect")
            .data(data)
            .enter().append("rect")
            .style("stroke", "black")
            .style("stroke-width", 1)
            .attr("x", function(d){return 0;})
            .attr("y", function(d,i){return bar_dist*i;})
            .attr("width", function(d){return 0;})
            .attr("height", function(d){return bar_dy;})
            .style("fill", function (d) { return d.color; })
            .on("mouseover", display_summary)
            .on("mouseout", function(){d3.select(this).style("stroke-width", 1);})
            .transition().duration(1000)
            .attr("width", function(d){return bar_dx*d.area;})

        sampleSVG.selectAll("text")
            .data(data)
            .enter().append("text")
            .attr("x", function(d){return 10;})
            .attr("y", function(d,i){return bar_dist*i + bar_dy*0.7;})
            .attr("text-anchor", "left")
            .style("font-size", 18)
            .style("font-weigth", "normal")
            .on("mouseover", display_summary)
            .on("mouseout", function(){d3.select(this).style("font-weight", "normal");})
            .transition().delay(1000)
            .text(function(d){return d.keywords;})


    }


    if({{date_ok}}==0) { // display error message if date not available
        d3.select("#viz")
            .append("svg")
            .attr("width", 800)
            .attr("height", 50)
            .append("svg:g")
            .attr("transform", "translate(10,20)")
            .append("text")
                .attr("x", 30)
                .attr("y", 10)
                .style("font-size", 25)
                .text("Sorry, this date is out of range... ")
         d3.select("#viz")
           .append("svg")
            .attr("width", 800)
            .attr("height", 50)
            .append("svg:g")
            .attr("transform", "translate(10,10)")
            .append("text")
                .attr("x", 30)
                .attr("y", 10)
                .style("font-size", 25)
                .text("Pick a date between 03/15/2016 and 02/05/2017")
   } 

   else{
        d3.json("/gdata?inputdate={{inputdate}}", callback);
    }


    </script>
</body>

</html>