<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <title>flask+d3 Hello World</title>

    <script src="http://d3js.org/d3.v2.js"></script>
    <style>

    #intro  {
        padding:3em;
    }

    path.line {
        fill: none;
        stroke: #666;
        stroke-width: 1.5px;
    }

    .domain {
        stroke-width: 1px;
    }

    circle {
        cursor: pointer;
    }

    .axis {
        shape-rendering: crispEdges;
    }

    .axis line, .axis path {
        stroke-width: 1px;
        stroke: #000;
        fill: none;
    }

    .tooltip {
        display: none;
    }

    .tooltip.active {
        display: block;
    }

    .tooltip rect {
        fill: #ff0000;
    }

        </style>

</head>

<body>

<a href="https://github.com/cranmer/flask-d3-hello-world"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>


    <h1>Simple example using d3.js &amp; Flask</h1>
    <div id="intro">This webpage uses d3 to draw some circles.  The data are generated on the fly by a simple flask application.  You can update the mean of the (x,y) pairs with the form.  This info is passed via ?mux=&lt;value&gt;&amp;muy=&lt;value&gt; which flask grabs, passes in rendering the template (which is used to fill out the form and in the all-important url to fetch the data via a d3.json() call. Of course, d3 coudl easily generate some random data by itself, but that's not the point of the exercise.</div>


    {% if mux %}
      <p>The point cloud has a mux={{mux}} muy={{muy}}</p>
        <form action="/">
            mean x = <input type="text" name="mux" value="{{mux}}">
            mean y = <input type="text" name="muy" value="{{muy}}">
            <input type="submit" value="Submit">
        </form>
    {% else %}
      <p>The point cloud has a mux=3. muy=3.</p>
        <form action="">
            mean x = <input type="text" name="mux" value="3.">
            mean y = <input type="text" name="muy" value="3.">
            <input type="submit" value="Submit">
        </form>
    {% endif %}

    <div id="info">
        <div id="point-info">
            Click on a point.
        </div>
    </div>

    <div id="plot">
    </div>


    <script>
    var diameter = 800, //max size of the bubbles
    color    = d3.scale.category20b(); //color category

var bubble = d3.layout.pack()
    .sort(null)
    .size([diameter, diameter])
    .padding(1.5);

var svg = d3.select("body")
    .append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");


// Load the data.
var callback = function (data) {

    //bubbles needs very specific format, convert data to this.
    var nodes = bubble.nodes({children:data}).filter(function(d) { return !d.children; });

    //setup the chart
    var bubbles = svg.append("g")
        .attr("transform", "translate(500,200)")
        
        .selectAll(".bubble")
        .data(nodes)
        .enter();

    //create the bubbles
    bubbles.append("circle")
        .attr("r", function(d){ return d.area*8; })
        .attr("cx", function(d){ return d.x; })
        .attr("cy", function(d){ return d.y; })
        .style("fill", function(d) { return color(d.color); });

 };

        {% if mux %}
            d3.json("/gdata?mux={{mux}}&muy={{muy}}", callback);
        {% endif %}

    </script>

</body>
</html>
